var $jscomp={scope:{},findInternal:function(a,d,c){a instanceof String&&(a=String(a));for(var e=a.length,g=0;g<e;g++){var f=a[g];if(d.call(c,f,g,a))return{i:g,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,c,e){if(d){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var g=a[e];g in c||(c[g]={});c=c[g]}a=a[a.length-1];e=c[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
define(function(){return{process:function(a){var d=a.domElems.musicInput.val(),c=$("#music .table"),e=$("#music .pagination"),g=this,f=function(h){var l=h.count,n=h.page,p=h.pageCount;h=h.tracks;var b="<thead><th>\u041a\u043e\u043c\u043f\u043e\u0437\u0438\u0446\u0438\u044f</th><th>\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e (\u043a\u0431\u0438\u0442/\u0441\u0435\u043a)</th></thead>",m;for(m in h)var k=h[m],q="music-"+k.id+"-"+Math.floor(1E5*Math.random()),b=b+"<tr>",b=b+"<td>",b=b+('<a href="#" data-id="'+
k.id+'" id="'+q+'" class="music"><span class="glyphicon glyphicon-play-circle"></span></a>'),b=b+('&nbsp;&nbsp;<a href="#" data-src="'+a.protocol+a.domain+"/audio/player/"+k.id+'" class="share"><span class="glyphicon glyphicon-bullhorn"></span></a> '),b=b+("&nbsp;&nbsp;"+k.artist+" - "+k.track+"</td>"),b=b+"<td>",b=a.user.email?b+('<a href="'+a.protocol+a.domain+"/audio/download/"+k.id+'" target="_blank"><span class="glyphicon glyphicon-floppy-save"></span></a> '+k.bitrate):b+('<span class="glyphicon glyphicon-floppy-save" title="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u0442\u043e\u043b\u044c\u043a\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u043c"></span> '+
k.bitrate),b=b+"<td>",b=b+"</tr>";c.html(b);b="";for(h=1;h<Math.floor(l/p);h++)m="",k=d+"/"+h,h==n&&(m="active",k=""),b+='<li class="'+m+'">',b+='<a data-src="'+k+'" href="#">'+h+"</a></li>";e.html(b);e.find("a").click(function(a){(a=$(this).data("src"))&&$.ajax({type:"GET",url:"/audio/list/"+a,success:function(a){f(a)},dataType:"json"})});c.find(".music").click(function(c){var b=$(this);b.data("src")?g.playMusic(a.domElems.audioPlayer,c,b.attr("id")):$.ajax({type:"GET",url:"/audio/player/"+b.data("id"),
success:function(d){b.html(b.html().replace(/\.\.\./ig," "+d.artist+" - "+d.track));b.data("src",d.url);g.playMusic(a.domElems.audioPlayer,c,b.attr("id"))},dataType:"json"});return!1});c.find(".share").click(function(){var b=a.domElems.inputMessage.val();a.domElems.inputMessage.val(b+$(this).data("src"));a.returnToChat()})};if(d){var l=Ladda.create(a.domElems.doMusicSearch.get(0));l.start();$.ajax({type:"GET",url:"/audio/list/"+d,success:function(a){f(a);l.stop()},error:function(a){c.html("<td>"+
a.status+" "+a.statusText+" "+a.responseText+"</td>");l.stop()},dataType:"json"})}},playMusic:function(a,d,c){var e=a.get(0),g=$("#"+c),f=$(d.currentTarget);d=a.data("current-track-id");c=$("#"+d);var l=this;e.addEventListener("ended",function(){g.find(".glyphicon-pause").removeClass("glyphicon-pause").addClass("glyphicon-play-circle");f.find(".audio-position").remove()});e.paused||e.ended||d!=f.attr("id")?(c.find(".glyphicon-pause").removeClass("glyphicon-pause").addClass("glyphicon-play-circle"),
d!=f.attr("id")&&(a.attr("src",f.data("src")),c.find(".audio-position").remove()),a.data("current-track-id",f.attr("id")),f.find(".glyphicon-play-circle").removeClass("glyphicon-play-circle").addClass("glyphicon-pause"),f.find(".audio-position").length||f.append('<span class="audio-position"></a>'),e.play()):(f.find(".glyphicon-pause").removeClass("glyphicon-pause").addClass("glyphicon-play-circle"),e.pause());e.addEventListener("timeupdate",function(){0<this.duration&&f.find(".audio-position").text("["+
l.formatTime(this.currentTime,this.duration)+"]")})},formatTime:function(a,d){var c=Math.floor((d-a)/60);a=Math.floor((d-a)%60);return"-"+c+":"+("0"+a).slice(-2)}}});
