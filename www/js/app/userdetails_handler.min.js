var $jscomp={scope:{},findInternal:function(a,d,b){a instanceof String&&(a=String(a));for(var g=a.length,c=0;c<g;c++){var f=a[c];if(d.call(b,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,b,g){if(d){b=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var c=a[g];c in b||(b[c]={});b=b[c]}a=a[a.length-1];g=b[a];d=d(g);d!=g&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
define(function(){return{app:{},process:function(a,d){this.app=a;this.updateInfo(d)},updateInfo:function(a){var d=this,b=this.app;$.ajax({url:"/user/info/"+a+"?v="+Math.random(1E3),type:"GET",success:function(a){var c=b.domElems.userDetails,f='<div class="user-avatar"><span class="glyphicon glyphicon-user" style="font-size: 148px"></span></div>';a.avatar&&(f='<img src="'+b.getImgUrl(a.avatar)+'" class="img-responsive img-rounded">');c.find(".photo").html(f);c.find(".name").text(a.name);c.find(".about").html(null==
a.about?"":a.about);c.find(".sex").text(a.sex);c.find(".tim").text(a.tim);c.find(".city").text(null==a.city?"":a.city);c.find(".birth").text(a.birth);c.find(".note-data").text(a.note);c.find(".online-time").text(a.onlineTime);c.find(".date-register").text(a.dateRegister);c.find(".word-rating").text(a.wordRating);c.find(".rude-rating").text(a.rudeRating);c.find(".music-rating").text(a.musicRating);c.find(".karma").text(a.karma);c.find(".names").text(a.names);b.domElems.userDetails.find(".mail-note").remove();
b.domElems.userDetails.find(".note-edit").remove();f=c.find(".actions");f.children().unbind();f.children().hide();for(var e in a.allowed)f.find("."+a.allowed[e]).show();d.bindActionIcons(f,a.id);c.find(".karma-details").empty();$(".tab-pane").removeClass("active");b.domElems.userDetails.toggleClass("active")},dataType:"json"})},bindActionIcons:function(a,d){var b=this.app,g=this;a.find(".ban").click(function(){b.send({subject:"Blacklist",action:"ban",user_id:d});g.updateInfo(d)});a.find(".unban").click(function(){b.send({subject:"Blacklist",
action:"unban",user_id:d});g.updateInfo(d)});a.find(".karma").click(function(){var a=b.domElems.userDetails.find(".karma-details");$.ajax({url:"/user/karma/"+d+"?v="+Math.random(1E3),type:"GET",success:function(c){var b='<ul class="list-group">',d;for(d in c)b+='<li class="list-group-item"><span class="badge">'+c[d].mark+"</span> "+c[d].evaluator+"</li>";a.html(b+'<li class="list-group-item">...</li></ul>');a.show()},dataType:"json"})});a.find(".karma-plus").click(function(){b.send({subject:"Properties",
action:"addKarma",user_id:d});g.updateInfo(d)});a.find(".karma-minus").click(function(){b.send({subject:"Properties",action:"decreaseKarma",user_id:d});g.updateInfo(d)});a.find(".note").click(function(){var a=b.domElems.userDetails.find(".note-data"),f=$("#note-edit");if(f.length)return f.remove(),!1;var e=$('<div class="input-group btn-block" id="note-edit"><input type="text" class="form-control"><span class="input-group-btn"><button class="btn btn-default" type="button"><span class="glyphicon glyphicon-pencil"></span></button></span></div></div>');
a.length&&e.find("input").val(a.text());a.html(e);e.find("input").focus();e.find("button").click(function(){var a={subject:"Note",action:"save",user_id:d,note:e.find("input").val()};b.send(a);g.updateInfo(d)})});a.find(".private").click(function(){b.togglePrivate(d)});a.find(".mail").click(function(){var a=b.domElems.userDetails.find(".mail-note"),f=$(".mail-note");if(f.length)return f.remove(),!1;a.length||(a=$('<br><div class="panel panel-default mail-note"></div>'),b.domElems.userDetails.find(".photo").parent().append(a));
var e='<div class="panel-heading">\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435</div>',e=e+'<div class="panel-body">',e=e+'<div class="input-group btn-block" id="mail-edit">',e=e+'<input type="text" class="form-control">',e=e+'<span class="input-group-btn">',e=e+'<button class="btn btn-default" type="button">',e=e+'<span class="glyphicon glyphicon-pencil"></span></button>',e=e+"</span>",e=e+"</div></div></div>",e=$(e);a.html(e);e.find("input").focus();
a.find("button").click(function(){var c={subject:"Message",msg:"/mail "+b.getUserInfoById(d).name+" "+e.find("input").val(),to:""};b.send(c);a.remove()})})}}});
